name: CI - ValidaÃ§Ã£o de Pull Request

on:
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x, 20.x]
    
    steps:
    - name: ğŸ“¥ Checkout do cÃ³digo
      uses: actions/checkout@v4

    - name: ğŸ” Verificar existÃªncia de index.html
      run: |
        if [ ! -f "index.html" ]; then
          echo "âŒ ERRO: Arquivo index.html nÃ£o encontrado na raiz do projeto!"
          echo "O GitHub Pages requer obrigatoriamente um arquivo index.html na raiz."
          exit 1
        fi
        echo "âœ… index.html encontrado com sucesso!"

    - name: ğŸ” Verificar nomes de arquivo invÃ¡lidos
      run: |
        if find . -type f \( -name "index-*.html" -o -name "home.html" \) | grep -q .; then
          echo "âŒ ERRO: Arquivos HTML com nome invÃ¡lido encontrados!"
          echo "Use apenas index.html na raiz do projeto."
          exit 1
        fi
        echo "âœ… Nomes de arquivo vÃ¡lidos!"

    - name: ğŸ’¾ Verificar tamanho dos arquivos (mÃ¡x 500KB)
      run: |
        echo "ğŸ” Verificando tamanho dos arquivos..."
        FILES=$(find . -type f -size +500k)
        if [ ! -z "$FILES" ]; then
          echo "âŒ ERRO: Arquivos maiores que 500KB encontrados:"
          echo "$FILES"
          echo "Comprima ou remova as imagens grandes."
          exit 1
        fi
        echo "âœ… Todos os arquivos estÃ£o dentro do limite de 500KB!"

    - name: ğŸ“ Verificar comentÃ¡rios e termos sensÃ­veis
      run: |
        echo "ğŸ” Verificando cÃ³digo em busca de TODO, FIXME, senha e password..."
        if grep -r "TODO\|FIXME\|senha\|password" --include="*.html" --include="*.js" --include="*.css" . 2>/dev/null; then
          echo "âŒ ERRO: ComentÃ¡rios ou termos sensÃ­veis encontrados!"
          echo "Remova TODO, FIXME, 'senha' e 'password' antes de fazer merge."
          exit 1
        fi
        echo "âœ… Nenhum comentÃ¡rio ou termo sensÃ­vel encontrado!"

    - name: ğŸ”— Verificar validade de links HTML
      run: |
        echo "ğŸ” Verificando tags HTML (links e imagens)..."
        # Verificar se hÃ¡ tags img ou a sem atributos vÃ¡lidos
        if grep -E '<img[^>]*src="[^"]*"[^>]*>' index.html | grep -E 'src=""' >/dev/null; then
          echo "âŒ ERRO: Tag img encontrada com src vazio!"
          exit 1
        fi
        if grep -E '<a[^>]*href="[^"]*"[^>]*>' index.html | grep -E 'href=""' >/dev/null; then
          echo "âŒ ERRO: Tag a encontrada com href vazio!"
          exit 1
        fi
        echo "âœ… Todos os links e imagens estÃ£o vÃ¡lidos!"

    - name: ğŸ“¦ Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}

    - name: ğŸ“œ Instalar HTML Linter
      run: npm install -g htmlhint

    - name: ğŸ”§ Executar Linter no HTML
      run: |
        echo "ğŸ” Executando HTMLHint para validaÃ§Ã£o de cÃ³digo..."
        htmlhint index.html || echo "âš ï¸  Alguns problemas de lintagem encontrados (avisos)"
        echo "âœ… ValidaÃ§Ã£o de HTML concluÃ­da!"

    - name: ğŸ‰ ValidaÃ§Ã£o concluÃ­da com sucesso!
      run: |
        echo "âœ… Todos os testes passaram com sucesso!"
        echo "ğŸš€ O cÃ³digo estÃ¡ pronto para ser mergeado para main!"
